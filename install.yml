---
- hosts: localhost
  become: true
  pre_tasks:
    - name: update repos
      apt: update_cache=yes
      changed_when: false

  tasks:
    - include: tasks/apt_install_packages.yml
    - include: tasks/apt_install_python_packages.yml
    - include: tasks/make_dirs.yml
    - include: tasks/install_android_udev_rules.yml

    - name: install sublimetext3 apt-key
      apt_key:
        url: https://download.sublimetext.com/sublimehq-pub.gpg
        state: present
      register: add_key

    - name: add sublimetext3 repo
      apt_repository:
        repo: "deb https://download.sublimetext.com/ apt/stable/"
        state: present
        update_cache: yes

    - name: install sublimetext3
      apt:
        name: sublime-text

    - name: install virtualenv and virtualenvwrapper
      pip:
        executable: pip3
        extra_args: --user
        name: "{{ item }}"
      with_items:
        - virtualenv
        - virtualenvwrapper

    - name: install docker apt-key
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        id: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
        state: present
      register: add_key

    - name: add docker repo
      apt_repository:
        repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable"
        state: present
        update_cache: yes

    - name: install docker
      apt:
        name: docker-ce
        state: present

    - name: add user to docker group
      user:
        name: "{{ ansible_user_id }}"
        append: yes
        groups: docker

    - name: install docker-compose
      shell: "sudo curl -L "https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose && chmod +x /usr/local/bin/docker-compose"

# Linking configs
    - name: link ackrc file
      file:
        src: ack/.ackrc
        dest: ~/.ackrc
        state: link

    - name: link .bashrc
      file:
        src: bash/.bashrc
        dest: ~/.bashrc
        state: link

# Handlers section
# Tasks in handlers section are not called unless called by tasks

handlers:
    - name: echo done
        shell: echo 'DOne'

